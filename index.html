<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cat√°logo Seguro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; margin:0; padding:0; background:#e6f2ff; }
#sidebar { position:fixed; top:0; left:0; width:200px; height:100vh; background:#222; padding-top:20px; overflow-y:auto; z-index:1000; transition:0.3s; }
#sidebar a { display:block; color:white; padding:12px 20px; text-decoration:none; font-weight:500; transition:0.2s; }
#sidebar a:hover { background:#333; color:#4CAF50; }
#toggleSidebar { position: fixed; top: 15px; left: 210px; background:#4CAF50; color:white; padding:8px 14px; font-size:16px; border:none; border-radius:5px; cursor:pointer; z-index:1100; transition: left 0.3s, top 0.3s, transform 0.2s; }
#toggleSidebar:hover { transform: scale(1.05); }
#main {margin-left:0; padding:20px; transition:0.3s;}
h1 { margin-top:0; text-align:center; margin-bottom:15px; font-size:30px; font-weight:600; color:#222; position:relative; }
h1::after { content:""; display:block; width:60px; height:3px; background:#4CAF50; margin:5px auto 0 auto; border-radius:2px; }

/* T√≠tulos de secciones mejorados */
h2 {
  font-size: 24px;
  font-weight: 700;
  color: #4CAF50;
  border-bottom: 3px solid #4CAF50;
  padding-bottom: 8px;
  margin-bottom: 25px;
  text-align: center;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

section {margin-bottom:40px;}
.productos { display:flex; flex-wrap:wrap; justify-content:center; gap:15px; }
.producto { display:flex; flex-direction:column; align-items:center; justify-content:center; width:150px; background:white; padding:10px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s; }
.producto:hover { transform: translateY(-5px); box-shadow:0 6px 15px rgba(0,0,0,0.2); }
.producto img { width:100px; height:100px; object-fit:cover; border-radius:5px; margin-bottom:5px; }
.detalle {text-align:center; width:100%;}
.detalle input[type="text"], .detalle input[type="url"], .detalle input[type="number"] { width:90%; margin-bottom:5px; padding:5px; font-size:14px; border:1px solid #ccc; border-radius:4px; }
.detalle p.descripcion { display: -webkit-box; -webkit-line-clamp:3; -webkit-box-orient: vertical; overflow:hidden; text-overflow:ellipsis; }

/* Botones WhatsApp */
button.pedir { padding:8px 12px; background:#4CAF50; color:white; border:none; border-radius:5px; cursor:pointer; font-size:14px; width:auto; min-width:120px; transition: transform 0.2s, box-shadow 0.2s; }
button.pedir:hover { transform: scale(1.05); box-shadow:0 4px 10px rgba(0,0,0,0.2); }

/* Botones Due√±o/Comprador */
#modoDuenoDiv { position: absolute; bottom: 20px; width: 100%; text-align: center; }
#modoDuenoDiv button { background:#333; color:white; padding:8px 0; font-size:14px; border-radius:5px; cursor:pointer; width:90%; margin:5px auto; display:flex; align-items:center; justify-content:center; gap:5px; transition: transform 0.2s, background 0.2s; }
#modoDuenoDiv button:hover { background:#555; transform: scale(1.05); }

/* Modal solo cantidad */
#modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; overflow:auto; background: rgba(0,0,0,0.5); }
#modalContent { background:white; margin:15% auto; padding:20px; border-radius:8px; width:90%; max-width:350px; text-align:center; position:relative; }
#modalContent h3 { margin-top:0; margin-bottom:15px; font-size:18px; }
#modalContent input { font-size:16px; padding:6px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; width:80%; }
#modalContent button { font-size:16px; padding:6px 12px; border:none; border-radius:5px; background:#4CAF50; color:white; cursor:pointer; }
#closeModal { position:absolute; top:10px; right:15px; font-size:20px; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>

<div id="sidebar">
  <a href="#mochilas">Mochilas</a>
  <a href="#mochilas-nena">Mochilas Nena</a>
  <a href="#mochilas-nene">Mochilas Nene</a>
  <a href="#mochilas-carro">Mochilas con Carro</a>
  <a href="#cartucheras">Cartucheras</a>
  <a href="#loncheras">Loncheras</a>
  <a href="#juegos-mesa">Juegos de Mesa</a>
  <a href="#juguetes">Juguetes</a>

  <div id="modoDuenoDiv">
    <button id="btnModo">üîí Activar modo Due√±o</button>
    <button id="btnComprador">üëÅÔ∏è Volver a Comprador</button>
  </div>
</div>

<button id="toggleSidebar">‚ò∞</button>

<div id="main">
  <h1>Cat√°logo</h1>
  <div id="catalogo">Cargando productos...</div>
</div>

<!-- Modal solo cantidad -->
<div id="modal">
  <div id="modalContent">
    <span id="closeModal">&times;</span>
    <h3 id="modalProducto">Producto</h3>
    <input type="number" id="modalCantidad" placeholder="Cantidad" min="1" value="1"><br>
    <button id="enviarWhatsApp">Enviar por WhatsApp</button>
  </div>
</div>

<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzTih4O2TSUH4s_4s8ac11iFRTRw3c81JGGUk2a0ag-FzLpExOM3Jchhf1mgqPc0S_C/exec';
const WHATSAPP_NUM = '543435136033';
let productosGlobal = [];
let modo = 'comprador';
let productoActual = '';

const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('toggleSidebar');
let sidebarOpen = true;

toggleBtn.addEventListener('click', ()=>{
  sidebarOpen = !sidebarOpen;
  sidebar.style.left = sidebarOpen ? '0' : '-200px';
  toggleBtn.style.left = sidebarOpen ? '210px' : '10px';
  toggleBtn.style.top = sidebarOpen ? '15px' : '10px';
});

document.getElementById('btnModo').addEventListener('click', ()=>{
  const clave = prompt("Ingrese contrase√±a de Due√±o:");
  if(clave === "a2y2l"){ 
    modo='dueno'; 
    alert("Modo Due√±o activado"); 
    mostrarProductos(); 
  } else { alert("Contrase√±a incorrecta"); }
});

document.getElementById('btnComprador').addEventListener('click', ()=>{ modo='comprador'; mostrarProductos(); });

async function cargarCatalogo(){
  try{
    const res = await fetch(SHEET_URL);
    productosGlobal = await res.json();
    mostrarProductos();
  }catch(err){
    document.getElementById("catalogo").innerHTML = "Error cargando cat√°logo.";
    console.error(err);
  }
}

// Mostrar productos con modo Due√±o/Comprador y bot√≥n WhatsApp
function mostrarProductos(){
  const cont = document.getElementById("catalogo");
  cont.innerHTML = "";
  const secciones = ["mochilas","mochilas-nena","mochilas-nene","mochilas-carro","cartucheras","loncheras","juegos-mesa","juguetes"];
  
  secciones.forEach(sec=>{
    const prodSec = productosGlobal.filter(p=>p.seccion===sec);
    if(prodSec.length===0) return;
    const sectionElem = document.createElement("section");
    sectionElem.id = sec;
    const h2 = document.createElement("h2");
    h2.textContent = sec.replace(/-/g," ");
    sectionElem.appendChild(h2);
    
    const divProductos = document.createElement("div");
    divProductos.className='productos';
    
    prodSec.forEach((prod,idx)=>{
      const div = document.createElement("div");
      div.className="producto";
      
      if(modo === 'comprador'){
        div.innerHTML = `
          <img src="${prod.imagen||'https://via.placeholder.com/100'}" alt="${prod.nombre}">
          <div class="detalle">
            <h3>${prod.nombre}</h3>
            <p>${prod.precio}</p>
            <p class="descripcion">${prod.desc}</p>
            <button class="pedir" onclick="abrirModal('${prod.nombre}')">Pedir</button>
          </div>
        `;
      } else {
        div.innerHTML = `
          <img src="${prod.imagen||'https://via.placeholder.com/100'}" id="img-${sec}-${idx}">
          <div class="detalle">
            <input type="url" id="imagen-${sec}-${idx}" placeholder="Link de imagen" value="${prod.imagen||''}"><br>
            <input type="text" id="nombre-${sec}-${idx}" value="${prod.nombre}"><br>
            <input type="text" id="precio-${sec}-${idx}" value="${prod.precio}"><br>
            <input type="text" id="desc-${sec}-${idx}" value="${prod.desc}"><br>
            <button onclick="guardar('${sec}',${idx})" style="width:100%;padding:8px;">Guardar</button>
          </div>
        `;
      }
      divProductos.appendChild(div);
    });

    sectionElem.appendChild(divProductos);
    cont.appendChild(sectionElem);
  });
}

// Modal WhatsApp
function abrirModal(nombre){
  productoActual = nombre;
  document.getElementById('modalProducto').textContent = nombre;
  document.getElementById('modalCantidad').value = 1;
  document.getElementById('modal').style.display = 'block';
}
document.getElementById('closeModal').onclick = ()=>{ document.getElementById('modal').style.display = 'none'; }
window.onclick = (e)=>{ if(e.target==document.getElementById('modal')) document.getElementById('modal').style.display='none'; }
document.getElementById('enviarWhatsApp').onclick = ()=>{
  const cant = document.getElementById('modalCantidad').value || 1;
  const msg = encodeURIComponent(`Hola! Quisiera pedir ${cant} de ${productoActual}`);
  window.open(`https://wa.me/${WHATSAPP_NUM}?text=${msg}`,'_blank');
  document.getElementById('modal').style.display = 'none';
}

// Guardar cambios (modo Due√±o)
function guardar(seccion,idx){
  const nombre = document.getElementById(`nombre-${seccion}-${idx}`).value;
  const precio = document.getElementById(`precio-${seccion}-${idx}`).value;
  const desc = document.getElementById(`desc-${seccion}-${idx}`).value;
  const imagen = document.getElementById(`imagen-${seccion}-${idx}`).value;

  fetch(SHEET_URL,{
    method:'POST',
    body:new URLSearchParams({seccion,nombre,precio,desc,imagen,index:idx})
  })
  .then(res=>res.json())
  .then(()=>alert("Guardado correctamente"))
  .catch(err=>alert("Error al guardar"));
}

cargarCatalogo();
</script>

</body>
</html>